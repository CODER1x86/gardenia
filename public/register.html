<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div id="header-placeholder"></div>
    <div class="container">
      <h4>Register</h4>
      <form id="register-form">
        <div class="input-field">
          <label for="username">Username</label>
          <input type="text" id="username" required />
        </div>
        <div class="input-field">
          <label for="password">Password</label>
          <input type="password" id="password" required />
          <meter max="4" id="password-strength-meter"></meter>
          <p id="password-strength-text"></p>
        </div>
        <div class="input-field">
          <label for="confirm-password">Confirm Password</label>
          <input type="password" id="confirm-password" required />
        </div>
        <div class="action-buttons">
          <button type="submit" class="btn waves-effect waves-light">
            Register
          </button>
        </div>
      </form>
    </div>
    <div id="footer-placeholder"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="./main.js"></script>
    <script>
      document
        .getElementById("password")
        .addEventListener("input", updatePasswordStrength);
      document
        .getElementById("register-form")
        .addEventListener("submit", (event) => {
          event.preventDefault();
          const password = document.getElementById("password").value;
          const confirmPassword =
            document.getElementById("confirm-password").value;

          if (password !== confirmPassword) {
            alert("Passwords do not match");
            return;
          }

          const username = document.getElementById("username").value;
          fetch("/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, password }),
          })
            .then((response) => {
              if (!response.ok) throw new Error("Error registering user");
              return response.json();
            })
            .then((data) => {
              alert("Registration successful");
              window.location.href = "login.html"; // Redirect to login page
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("Registration failed. Please try again.");
            });
        });

      function updatePasswordStrength() {
        const password = document.getElementById("password").value;
        const meter = document.getElementById("password-strength-meter");
        const text = document.getElementById("password-strength-text");
        const strength = calculatePasswordStrength(password);

        meter.value = strength.score;
        text.textContent = `Strength: ${strength.text}`;
      }

      function calculatePasswordStrength(password) {
        let score = 0;
        let text = "Very Weak";

        if (password.length >= 8) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;

        switch (score) {
          case 1:
            text = "Weak";
            break;
          case 2:
            text = "Fair";
            break;
          case 3:
            text = "Good";
            break;
          case 4:
            text = "Strong";
            break;
        }

        return { score, text };
      }
    </script>
  </body>
</html>
